<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AdministraciÃ³n de Usuarios â€” Plataforma ISO</title>

  <!-- CSRF para las peticiones AJAX -->
  <meta name="_csrf" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:content="${_csrf.headerName}" />

  <!-- Mismo CSS del dashboard -->
  <link rel="stylesheet" th:href="@{/css/dashboard.css}">
  <!-- Estilos especÃ­ficos SOLO para esta pantalla de usuarios -->
  <link rel="stylesheet" th:href="@{/css/catalogoProcesosAdmin.css}">
</head>

<body>

  <!-- BotÃ³n menÃº mÃ³vil -->
  <button class="menu-toggle">â˜°</button>

  <!-- LAYOUT PRINCIPAL -->
  <div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        Certificaciones ISO
      </div>

      <button class="sidebar-collapse-btn" type="button" title="Colapsar/expandir menÃº">â®œ</button>

      <nav class="sidebar-nav">

        <!-- ADMINISTRADOR / SGI -->
        <th:block th:if="${tipoUsuario == 'ADMINISTRADOR' or tipoUsuario == 'SGI'}">

          <!-- Administrar usuarios (marcado como activo) -->
          <a th:href="@{/dashboard}" class="item" th:classappend="${active=='usuarios' ? ' active' : ''}">
            <span class="icon">ğŸ›ï¸</span>
            <span class="text">Mi Dashboard</span>
          </a>

          <!-- Grupo Crear archivo + submenu -->
          <div class="item-group">
            <!-- Trigger del submenÃº -->
            <a href="javascript:void(0)" class="item submenu-toggle2">
              <span class="icon">ğŸ“</span>
              <span class="text">Usuarios y Licencias</span>
              <span class="arrow">â–¾</span>
            </a>

            <!-- SubmenÃº -->
            <div class="submenu" id="submenu-crear-usuarios">

              <!-- GestiÃ³n de usuarios -->
              <a th:href="@{/admin/usuarios}" class="item">
                <span class="icon">ğŸ‘¥</span>
                <span class="text">Administrar usuarios</span>
              </a>

              <!-- GestiÃ³n de licencias -->
              <a href="/licencias" class="item">
                <span class="icon">ğŸ«</span>
                <span class="text">Asignar licencias</span>
              </a>

            </div>

            <!-- Trigger del submenÃº -->
            <a href="javascript:void(0)" class="item submenu-toggle3">
              <span class="icon">ğŸ“</span>
              <span class="text">Catalogos</span>
              <span class="arrow">â–¾</span>
            </a>

            <!-- SubmenÃº -->
            <div class="submenu" id="submenu-crear-catalogos">

              <a href="/admin/catalogoProcesos" class="item">
                <span class="icon">ğŸ«</span>
                <span class="text">Catalogo de procesos</span>
              </a>

              <a href="/admin/catalogoDocumentos" class="item">
                <span class="icon">ğŸ«</span>
                <span class="text">Catalogo de documentos</span>
              </a>

            </div>
          </div>


          <a href="/licencias" class="item">
            <span class="icon">ğŸ«</span>
            <span class="text">ProducciÃ³n</span>
          </a>



          <a href="#" class="item" th:classappend="${active=='admin' ? ' active' : ''}">
            <span class="icon">ğŸ› ï¸</span>
            <span class="text">LÃ­der administrador</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='sgi' ? ' active' : ''}">
            <span class="icon">ğŸ§©</span>
            <span class="text">LÃ­der de SGI</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='calidad' ? ' active' : ''}">
            <span class="icon">âœ…</span>
            <span class="text">LÃ­der de Calidad</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='rh' ? ' active' : ''}">
            <span class="icon">ğŸ‘¤</span>
            <span class="text">LÃ­der de Recursos Humanos</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='compras' ? ' active' : ''}">
            <span class="icon">ğŸ›’</span>
            <span class="text">LÃ­der de Compras</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='manto' ? ' active' : ''}">
            <span class="icon">ğŸ”§</span>
            <span class="text">LÃ­der de Mantenimiento</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='almacen' ? ' active' : ''}">
            <span class="icon">ğŸ“¦</span>
            <span class="text">LÃ­der de AlmacÃ©n</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='oper' ? ' active' : ''}">
            <span class="icon">âš™ï¸</span>
            <span class="text">LÃ­der de Operaciones</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='planeacion' ? ' active' : ''}">
            <span class="icon">ğŸ“ˆ</span>
            <span class="text">LÃ­der de PlaneaciÃ³n</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='seg' ? ' active' : ''}">
            <span class="icon">ğŸ¦º</span>
            <span class="text">LÃ­der de seguridad e higiene</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='dev' ? ' active' : ''}">
            <span class="icon">ğŸ’»</span>
            <span class="text">LÃ­der de Desarrollo</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='ti' ? ' active' : ''}">
            <span class="icon">ğŸ’¾</span>
            <span class="text">LÃ­der de TI</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='fact' ? ' active' : ''}">
            <span class="icon">ğŸ§¾</span>
            <span class="text">LÃ­der de facturaciÃ³n y embarques</span>
          </a>
        </th:block>

        <!-- LÃDERES -->
        <th:block th:if="${tipoUsuario != 'ADMINISTRADOR' and tipoUsuario != 'SGI'}">
          <a href="/archivos/nuevo" class="item">
            <span class="icon">ğŸ“</span>
            <span class="text">Crear archivo</span>
          </a>
          <a href="#" class="item">
            <span class="icon">ğŸ“Š</span>
            <span class="text">Mi progreso</span>
          </a>
          <a href="#" class="item">
            <span class="icon">ğŸ“</span>
            <span class="text">Documentos asignados</span>
          </a>
          <a href="#" class="item">
            <span class="icon">âœ…</span>
            <span class="text">Mis actividades</span>
          </a>
        </th:block>
      </nav>
    </aside>

    <!-- MAIN -->
    <main class="main">

      <!-- TOPBAR -->
      <header class="topbar">
        <div class="topbar-left">
          <span class="topbar-title">Catalogo de Procesos</span>
        </div>

        <div class="topbar-right">

          <!-- Notificaciones -->
          <div class="notifications">
            <button class="icon-btn" type="button" title="Notificaciones">
              ğŸ””
              <span class="badge">2</span>
            </button>

            <div class="notifications-panel">
              <div class="notifications-header">
                <span>Notificaciones</span>
                <span>2 nuevas</span>
              </div>

              <div class="notification-item">
                <div class="notification-title">Onboarding incompleto</div>
                <div class="notification-body">
                  AÃºn tienes pasos pendientes en el proceso inicial de la compaÃ±Ã­a.
                </div>
                <div class="notification-meta">Hace 10 min</div>
              </div>

              <div class="notification-item">
                <div class="notification-title">Nueva tarea asignada</div>
                <div class="notification-body">
                  Tienes un nuevo documento para revisar y completar.
                </div>
                <div class="notification-meta">Hace 1 hora</div>
              </div>

              <div class="notifications-footer">
                <a href="#">Ver todas</a>
              </div>
            </div>
          </div>

          <!-- MenÃº usuario -->
          <div class="user-menu">
            <div class="user-chip">
              <span class="user-avatar">
                <span th:text="${#strings.substring(username,0,1)}">U</span>
              </span>
              <div class="user-info">
                <span class="user-name" id="usuerLoggedIn" th:text="${username}">Usuario</span>
                <span class="user-role" th:text="${tipoUsuario}">ROL</span>
              </div>
            </div>

            <div class="user-dropdown">
              <a href="/perfil" class="dropdown-item">Mi perfil</a>
              <a href="/configuracion" class="dropdown-item">ConfiguraciÃ³n</a>
              <form th:action="@{/logout}" method="post" class="dropdown-item logout-form">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button type="submit" class="logout-btn">Cerrar sesiÃ³n</button>
              </form>
            </div>
          </div>

        </div>
      </header>

      <!-- CONTENIDO -->

      <div class="content-wrap">

        <div th:if="${ok}" class="alert success" th:text="${ok}"></div>
        <div th:if="${error}" class="alert error" th:text="${error}"></div>

        <div class="card card-lg">
          <div class="title">Catalogo de Procesos</div>
          <div class="subtitle">
            Gestiona el catÃ¡logo de procesos de la compaÃ±Ã­a. <br>Agrega, Elimina o Modifica los procesos predeterminados acorde a los utilizados dentro de la empresa
          </div>

          <!-- ğŸ”¹ Formulario compacto para alta / ediciÃ³n rÃ¡pida -->
          <form id="formProceso" class="process-form">
            <input type="hidden" id="idProceso">

            <div class="process-form-group">
              <label class="process-label" for="nombreProceso">Nombre del proceso</label>
              <input type="text" id="nombreProceso" name="nombreProceso" class="process-input" required>
            </div>

            <div class="process-form-group">
              <label class="process-label" for="codigoProceso">CÃ³digo</label>
              <input type="text" id="codigoProceso" name="codigoProceso" class="process-input" required>
            </div>

            <div class="process-form-actions">
              <button type="submit" class="btn">Guardar</button>
            </div>

            <div id="errorForm" class="process-error"></div>
          </form>

          <!-- ğŸ”¹ Barra de bÃºsqueda y botones auxiliares -->

          <!-- Toolbar: buscador + botÃ³n refrescar -->
          <div class="catalog-toolbar">
            <input id="buscarProceso" type="text" class="form-input catalog-search"
              placeholder="Buscar por nombre o cÃ³digoâ€¦">

            <button type="button" class="btn btn-secondary" id="btnRefrescarProcesos">
              Refrescar
            </button>
          </div>

          <!-- Tabla -->
          <div class="catalog-table-wrapper">
            <table class="catalog-table">
              <thead>
                <tr>
                  <th style="width: 100px;">ID Proceso</th>
                  <th style="width: 120px;">CÃ³digo</th>
                  <th>Nombre del proceso</th>
                 
                  <th style="width: 140px; text-align:center;">Acciones</th>
                </tr>
              </thead>
              <tbody id="tbodyProcesos">
                <tr th:each="p : ${procesos}">
                  <td th:text="${p.idProceso}">1</td>
                  <td th:text="${p.codigoProceso}">PR</td>
                  <td th:text="${p.nombreProceso}">ProducciÃ³n</td>
                 
                  <td class="col-acciones">
                    <button type="button" class="btn btn-secondary btn-xs btnEditarProceso"
                      th:attr="data-id=${p.idProceso}">
                      Editar
                    </button>
                    <button type="button" class="btn btn-danger btn-xs btnEliminarProceso"
                      th:attr="data-id=${p.idProceso}">
                      Eliminar
                    </button>
                  </td>
                </tr>

                <tr th:if="${#lists.isEmpty(procesos)}">
                  <td colspan="5" class="catalog-empty">
                    No se encontraron procesos registrados.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>


        </div>
      </div>
    </main>
  </div>



  <!-- JS del dashboard (sidebar, menÃºs, etc.) -->
  <script src="/js/dashboard.js"></script>
  <!-- JS especÃ­fico de usuarios -->
  <script src="/js/catalogsCrud/catalogoProcesosAdmin.js"></script>

  <!--<script src="/js/seguridad-global.js"></script>-->
</body>

</html>