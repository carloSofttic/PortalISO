<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AdministraciÃ³n de Usuarios â€” Plataforma ISO</title>

  <!-- CSRF para las peticiones AJAX -->
  <meta name="_csrf" th:content="${_csrf.token}" />
  <meta name="_csrf_header" th:content="${_csrf.headerName}" />

  <!-- Mismo CSS del dashboard -->
  <link rel="stylesheet" th:href="@{/css/dashboard.css}">
  <!-- Estilos especÃ­ficos SOLO para esta pantalla de usuarios -->
  <link rel="stylesheet" th:href="@{/css/usuariosAdmin.css}">
</head>

<body>

  <!-- BotÃ³n menÃº mÃ³vil -->
  <button class="menu-toggle">â˜°</button>

  <!-- LAYOUT PRINCIPAL -->
  <div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-logo">
        Certificaciones ISO
      </div>

      <button class="sidebar-collapse-btn" type="button" title="Colapsar/expandir menÃº">â®œ</button>

      <nav class="sidebar-nav">

        <!-- ADMINISTRADOR / SGI -->
        <th:block th:if="${tipoUsuario == 'ADMINISTRADOR' or tipoUsuario == 'SGI'}">

          <!-- Administrar usuarios (marcado como activo) -->
          <a th:href="@{/admin/usuarios}" class="item" th:classappend="${active=='usuarios' ? ' active' : ''}">
            <span class="icon">ğŸ‘¥</span>
            <span class="text">Administrar usuarios</span>
          </a>

          <a href="/licencias" class="item">
            <span class="icon">ğŸ«</span>
            <span class="text">Asignar licencias</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='dg' ? ' active' : ''}">
            <span class="icon">ğŸ›ï¸</span>
            <span class="text">DirecciÃ³n General</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='admin' ? ' active' : ''}">
            <span class="icon">ğŸ› ï¸</span>
            <span class="text">LÃ­der administrador</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='sgi' ? ' active' : ''}">
            <span class="icon">ğŸ§©</span>
            <span class="text">LÃ­der de SGI</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='calidad' ? ' active' : ''}">
            <span class="icon">âœ…</span>
            <span class="text">LÃ­der de Calidad</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='rh' ? ' active' : ''}">
            <span class="icon">ğŸ‘¤</span>
            <span class="text">LÃ­der de Recursos Humanos</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='compras' ? ' active' : ''}">
            <span class="icon">ğŸ›’</span>
            <span class="text">LÃ­der de Compras</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='manto' ? ' active' : ''}">
            <span class="icon">ğŸ”§</span>
            <span class="text">LÃ­der de Mantenimiento</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='almacen' ? ' active' : ''}">
            <span class="icon">ğŸ“¦</span>
            <span class="text">LÃ­der de AlmacÃ©n</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='oper' ? ' active' : ''}">
            <span class="icon">âš™ï¸</span>
            <span class="text">LÃ­der de Operaciones</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='planeacion' ? ' active' : ''}">
            <span class="icon">ğŸ“ˆ</span>
            <span class="text">LÃ­der de PlaneaciÃ³n</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='seg' ? ' active' : ''}">
            <span class="icon">ğŸ¦º</span>
            <span class="text">LÃ­der de seguridad e higiene</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='dev' ? ' active' : ''}">
            <span class="icon">ğŸ’»</span>
            <span class="text">LÃ­der de Desarrollo</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='ti' ? ' active' : ''}">
            <span class="icon">ğŸ’¾</span>
            <span class="text">LÃ­der de TI</span>
          </a>

          <a href="#" class="item" th:classappend="${active=='fact' ? ' active' : ''}">
            <span class="icon">ğŸ§¾</span>
            <span class="text">LÃ­der de facturaciÃ³n y embarques</span>
          </a>
        </th:block>

        <!-- LÃDERES -->
        <th:block th:if="${tipoUsuario != 'ADMINISTRADOR' and tipoUsuario != 'SGI'}">
          <a href="/archivos/nuevo" class="item">
            <span class="icon">ğŸ“</span>
            <span class="text">Crear archivo</span>
          </a>
          <a href="#" class="item">
            <span class="icon">ğŸ“Š</span>
            <span class="text">Mi progreso</span>
          </a>
          <a href="#" class="item">
            <span class="icon">ğŸ“</span>
            <span class="text">Documentos asignados</span>
          </a>
          <a href="#" class="item">
            <span class="icon">âœ…</span>
            <span class="text">Mis actividades</span>
          </a>
        </th:block>
      </nav>
    </aside>

    <!-- MAIN -->
    <main class="main">

      <!-- TOPBAR -->
      <header class="topbar">
        <div class="topbar-left">
          <span class="topbar-title">AdministraciÃ³n de usuarios</span>
        </div>

        <div class="topbar-right">

          <!-- Notificaciones -->
          <div class="notifications">
            <button class="icon-btn" type="button" title="Notificaciones">
              ğŸ””
              <span class="badge">2</span>
            </button>

            <div class="notifications-panel">
              <div class="notifications-header">
                <span>Notificaciones</span>
                <span>2 nuevas</span>
              </div>

              <div class="notification-item">
                <div class="notification-title">Onboarding incompleto</div>
                <div class="notification-body">
                  AÃºn tienes pasos pendientes en el proceso inicial de la compaÃ±Ã­a.
                </div>
                <div class="notification-meta">Hace 10 min</div>
              </div>

              <div class="notification-item">
                <div class="notification-title">Nueva tarea asignada</div>
                <div class="notification-body">
                  Tienes un nuevo documento para revisar y completar.
                </div>
                <div class="notification-meta">Hace 1 hora</div>
              </div>

              <div class="notifications-footer">
                <a href="#">Ver todas</a>
              </div>
            </div>
          </div>

          <!-- MenÃº usuario -->
          <div class="user-menu">
            <div class="user-chip">
              <span class="user-avatar">
                <span th:text="${#strings.substring(username,0,1)}">U</span>
              </span>
              <div class="user-info">
                <span class="user-name" id="usuerLoggedIn" th:text="${username}">Usuario</span>
                <span class="user-role" th:text="${tipoUsuario}">ROL</span>
              </div>
            </div>

            <div class="user-dropdown">
              <a href="/perfil" class="dropdown-item">Mi perfil</a>
              <a href="/configuracion" class="dropdown-item">ConfiguraciÃ³n</a>
              <form th:action="@{/logout}" method="post" class="dropdown-item logout-form">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button type="submit" class="logout-btn">Cerrar sesiÃ³n</button>
              </form>
            </div>
          </div>

        </div>
      </header>

      <!-- CONTENIDO -->
      <div class="content-wrap">

        <div th:if="${ok}" class="alert success" th:text="${ok}"></div>
        <div th:if="${error}" class="alert error" th:text="${error}"></div>

        <div class="card card-lg users-page">
          <div class="title">AdministraciÃ³n de Usuarios</div>
          <div class="subtitle">Gestiona los usuarios de la compaÃ±Ã­a.</div>

          <!-- Toolbar -->
          <div class="users-toolbar">
            <input id="buscador" type="text" placeholder="Buscar por nombre, usuario, correo, rol...">
            <button class="btn btn-secondary" id="btnRefrescar">Refrescar</button>
            <button class="btn btn-primary" id="btnNuevo">+ Nuevo usuario</button>
          </div>

          <!-- Tabla -->
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>ID Usuario</th>
                  <th>Nombre completo</th>
                  <th>Correo</th>
                  <th>Usuario</th>
                  <th>Rol</th>
                  <th>Fecha creaciÃ³n</th>
                  <th style="width: 130px;">Acciones</th>
                </tr>
              </thead>
              <tbody id="tbodyUsuarios">
                <!-- se llena por JS -->
              </tbody>
            </table>
          </div>
        </div>
      </div> <!-- /content-wrap -->
    </main>
  </div>

  <!-- MODAL alta / ediciÃ³n -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="modal">
      <div class="modal-header">
        <h2 id="modalTitulo">Nuevo usuario</h2>
        <button class="btn btn-secondary" type="button" id="btnCerrarModal">X</button>
      </div>
      <form id="formUsuario">
        <div class="modal-body">
          <input type="hidden" id="idUsuario">
          <input type="hidden" id="idMiembro">

          <label>
            Nombre
            <input type="text" id="nombre" required>
          </label>

          <label>
            Apellido paterno
            <input type="text" id="apPaterno" required>
          </label>

          <label>
            Apellido materno
            <input type="text" id="apMaterno" required>
          </label>

          <label>
            TelÃ©fono
            <input type="text" id="telefono" maxlength="15">
          </label>

          <label>
            Correo electrÃ³nico
            <input type="email" id="email" required>
          </label>

          <label>
            Nombre de usuario
            <input type="text" id="username" required>
          </label>

          <label>
            Rol / Tipo de usuario
            <select id="tipoUsuario" required>
              <option value="">Seleccione...</option>
              <option value="ADMINISTRADOR">ADMINISTRADOR</option>
              <option value="SGI">SGI</option>
              <option value="LIDER PRODUCCION">LÃDER PRODUCCIÃ“N</option>
              <option value="LIDER SOPORTE TECNICO">LÃDER SOPORTE TÃ‰CNICO</option>
            </select>
          </label>

          <label>
            Password (solo alta)
            <input type="password" id="password">
          </label>
        </div>

        <div id="errorForm" class="error-msg"></div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" id="btnCancelar">Cancelar</button>
          <button type="submit" class="btn btn-primary" id="btnGuardar">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- JS del dashboard (sidebar, menÃºs, etc.) -->
  <script src="/js/dashboard.js"></script>
  <!-- JS especÃ­fico de usuarios -->
  <script src="/js/usersCrud/usuariosAdmin.js"></script>
</body>

</html>
